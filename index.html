<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GEAR HUB | Student OS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: { background: '#020617', text: '#F8FAFC' },
            fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['Fira Code', 'monospace'] },
            animation: { 'spin-slow': 'spin 3s linear infinite' }
          }
        }
      }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Recharts & Lucide (via UMD/Global for simplicity in pure HTML) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Note: Lucide React icons are created dynamically in the code below to avoid import complexity -->

    <style>
      :root { --bg-primary: #020617; --text-primary: #F8FAFC; }
      body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        background-image: radial-gradient(circle at 15% 50%, rgba(6, 182, 212, 0.08), transparent 25%), radial-gradient(circle at 85% 30%, rgba(59, 130, 246, 0.08), transparent 25%);
        background-attachment: fixed;
      }
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
      .glass-panel {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .animate-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    </style>
  <script type="importmap">
{
  "imports": {
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.31.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
      const { useState, useEffect, useRef, useMemo } = React;
      const { 
        LayoutDashboard, BookOpen, Calendar, MessageSquare, BarChart2, LogOut, Search, Bell, Settings, Shield, Users, Hexagon, FileText, Timer, Video, Check, X, Gamepad2,
        Clock, CheckCircle, Target, BrainCircuit, TrendingUp, Plus, Zap, ChevronDown, Trash2, Ghost, Calculator, Globe, Beaker, Code, Languages, History, Brain, Trophy,
        RotateCcw, Play, Pause, Coffee, Lock, Camera, Mail, BadgeCheck, Save, Loader2, Send, Bot, Sparkles, UserPlus, Hash, Edit3, Upload, MapPin, Copy, PhoneOff, ArrowRight
      } = window.lucide; // Lucide icons via global

      // --- Lucide React Wrapper for compatibility ---
      const Icon = ({ icon, ...props }) => {
        const IconComponent = window.lucide[icon.name] || window.lucide.HelpCircle; // Fallback
        // In UMD lucide, we might need to create elements if not using the React wrapper. 
        // For this single-file setup, we map known icons to a helper or just use the Lucide globals if possible.
        // Actually, Lucide UMD injects `lucide.createIcons`, but we want React components.
        // Simplified: We will just use the global variables destructured above as components.
        return null;
      };

      // --- CONFIG & SERVICES ---
      const CONFIG = {
        GEMINI_API_KEY: 'AIzaSyAKr_-8zVfO-Qd7T6yWcVVn-mAaxTvYEjg', // Demo Key
      };

      // Direct Fetch for Gemini (No SDK needed for HTML file)
      const generateContent = async (prompt, systemInstruction = "") => {
        if (!CONFIG.GEMINI_API_KEY) return "API Key Missing";
        try {
          const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${CONFIG.GEMINI_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined
            })
          });
          const data = await res.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text || "No response";
        } catch (e) {
          console.error(e);
          return "Error connecting to AI.";
        }
      };

      const generateJSON = async (prompt, schema) => {
         const text = await generateContent(`${prompt} Respond in strictly valid JSON format.`, "You are a JSON generator.");
         try {
             // Clean markdown code blocks if present
             const clean = text.replace(/```json/g, '').replace(/```/g, '').trim();
             return JSON.parse(clean);
         } catch (e) {
             console.error("JSON Parse Error", e);
             return null;
         }
      };

      // --- UI COMPONENTS ---
      const GlassCard = ({ children, className = '', hoverEffect = false, onClick }) => (
        <div 
          onClick={onClick}
          className={`
            relative overflow-hidden
            bg-[#1e293b]/40 backdrop-blur-3xl 
            border border-white/10 rounded-[2rem] p-6 shadow-2xl
            before:absolute before:inset-0 before:bg-gradient-to-br before:from-white/5 before:to-transparent before:opacity-50 before:pointer-events-none
            ${hoverEffect ? 'transition-all duration-300 hover:bg-[#1e293b]/60 hover:scale-[1.01] hover:border-cyan-500/20 hover:shadow-[0_0_30px_-5px_rgba(6,182,212,0.15)] cursor-pointer' : ''}
            ${className}
          `}
        >
          {children}
        </div>
      );

      // --- GAMES COMPONENT (The Complex Logic) ---
      const Games = ({ user, onXPAction }) => {
        const [activeGame, setActiveGame] = useState(null);
        const [selectedGameConfig, setSelectedGameConfig] = useState(null);

        // Catalog
        const GAMES_CATALOG = [
          { id: 'flappy', name: 'Sky Hop', icon: Ghost, description: 'Fly & learn with flashcards!', minLevel: 1, color: 'from-green-400 to-emerald-500', type: 'ACTION' },
          { id: 'math', name: 'Math Sprint', icon: Calculator, description: 'Solve equations fast!', minLevel: 1, color: 'from-yellow-400 to-orange-500', type: 'ACTION' },
          { id: 'snake', name: 'Neon Snake', icon: Gamepad2, description: 'Classic snake game', minLevel: 1, color: 'from-green-500 to-lime-500', type: 'RETRO' },
          { id: 'pong', name: 'Cyber Pong', icon: Gamepad2, description: 'Paddle battle', minLevel: 2, color: 'from-blue-500 to-indigo-500', type: 'RETRO' },
          { id: 'memory', name: 'Memory Match', icon: Brain, description: 'Focus trainer', minLevel: 1, color: 'from-pink-400 to-rose-500', type: 'ACTION' },
          { id: 'history', name: 'History Timeline', icon: History, description: 'Dates & Events', minLevel: 3, color: 'from-amber-400 to-orange-500', type: 'QUIZ', prompt: 'Historical events' },
          { id: 'science', name: 'Science Sorter', icon: Beaker, description: 'Physics & Bio', minLevel: 2, color: 'from-purple-400 to-indigo-500', type: 'QUIZ', prompt: 'General science' },
        ];

        const handleGameSelect = (game) => {
            if ((user?.level || 1) < game.minLevel) {
                alert(`Locked! Reach Level ${game.minLevel} to play.`);
                return;
            }
            setSelectedGameConfig(game);
            setActiveGame(game.id);
        };

        const renderGame = () => {
            switch(activeGame) {
                case 'flappy': return <FlappyBird onHighScore={() => onXPAction?.(10)} onXPAction={onXPAction} />;
                case 'math': return <MathSprint onWin={(s) => onXPAction?.(s)} />;
                case 'snake': return <SnakeGame onWin={(s) => onXPAction?.(s)} />;
                case 'pong': return <PongGame onWin={(s) => onXPAction?.(s)} />;
                case 'memory': return <MemoryMatch onWin={() => onXPAction?.(15)} />;
                default: 
                    if (selectedGameConfig?.type === 'QUIZ') {
                        return <UniversalQuiz config={selectedGameConfig} onWin={(s) => onXPAction?.(s)} />;
                    }
                    return <div>Coming Soon</div>;
            }
        };

        return (
          <div className="space-y-8 h-full flex flex-col">
            <div className="flex justify-between items-center">
              <div>
                  <h2 className="text-4xl font-bold text-white flex items-center gap-3 tracking-tight">
                  <Gamepad2 className="w-10 h-10 text-purple-400" /> Arcade Zone
                  </h2>
                  <p className="text-slate-400 mt-1">Play, Learn, Earn XP.</p>
              </div>
              {activeGame && (
                <button 
                  onClick={() => { setActiveGame(null); setSelectedGameConfig(null); }}
                  className="px-5 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-sm font-bold transition-all flex items-center gap-2 hover:scale-105"
                >
                  <RotateCcw className="w-4 h-4" /> Back
                </button>
              )}
            </div>

            {!activeGame ? (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pb-10">
                {GAMES_CATALOG.map(game => {
                   const isLocked = (user?.level || 1) < game.minLevel;
                   const IconC = game.icon;
                   return (
                      <GlassCard 
                      key={game.id}
                      onClick={() => handleGameSelect(game)}
                      className={`relative group transition-all text-center py-8 flex flex-col items-center justify-between min-h-[260px] ${isLocked ? 'opacity-60 grayscale cursor-not-allowed' : 'hover:scale-[1.02] cursor-pointer'}`}
                      >
                      {isLocked && <div className="absolute top-3 right-3 bg-black/50 p-1.5 rounded-full border border-white/10 backdrop-blur-md z-20"><Lock className="w-4 h-4 text-slate-400" /></div>}
                      <div className={`w-20 h-20 rounded-full bg-gradient-to-br ${game.color} opacity-20 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 blur-2xl group-hover:opacity-40 transition-opacity`}></div>
                      <div className="relative z-10 transform group-hover:scale-110 transition-transform duration-300">
                          <IconC className={`w-8 h-8 ${isLocked ? 'text-slate-500' : 'text-white'}`} />
                      </div>
                      <div className="relative z-10 w-full mt-4">
                          <h3 className="text-lg font-bold text-white mb-1">{game.name}</h3>
                          <p className="text-slate-400 text-xs px-2">{game.description}</p>
                      </div>
                      <div className="relative z-10 mt-4 w-full px-4">
                          {isLocked ? <div className="w-full py-1.5 bg-slate-800/50 rounded-lg border border-white/5 text-slate-500 text-[10px] font-bold uppercase">Lvl {game.minLevel}</div> 
                                    : <button className="w-full py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold text-xs border border-white/10 shadow-lg">Play</button>}
                      </div>
                      </GlassCard>
                   );
                })}
              </div>
            ) : (
              <div className="flex-1 flex justify-center items-start pt-4 pb-10">{renderGame()}</div>
            )}
          </div>
        );
      };

      // --- SKY HOP (DOM Version) ---
      const FlappyBird = ({ onHighScore, onXPAction }) => {
        const [mode, setMode] = useState('MENU');
        const [topic, setTopic] = useState('');
        const [score, setScore] = useState(0); 
        const [highScore, setHighScore] = useState(parseInt(localStorage.getItem('gearhub_flappy_score') || '0'));
        const [vsBot, setVsBot] = useState(false);
        const [botScore, setBotScore] = useState(0);
        const [cards, setCards] = useState([]);
        const [currentCard, setCurrentCard] = useState(null);
        const [selectedOption, setSelectedOption] = useState(null);

        // DOM Physics
        const [birdY, setBirdY] = useState(250);
        const [pipes, setPipes] = useState([]);
        const [velocity, setVelocity] = useState(0);
        const physics = useRef({ y: 250, v: 0, pipes: [], frames: 0, score: 0 });

        // Bot Logic
        useEffect(() => {
           if (mode === 'PLAYING' && vsBot) {
               const i = setInterval(() => { if(Math.random() > 0.5) setBotScore(s => s+1); }, 2000);
               return () => clearInterval(i);
           }
        }, [mode, vsBot]);

        const start = async () => {
            setMode('LOADING');
            // Mock Flashcards if API fails, or use API
            const json = await generateJSON(`Generate 10 multiple choice questions about ${topic} with question, options (array), and answer.`, "");
            setCards(json?.questions || json?.flashcards || [{question: "Test Q", options:["A","B"], answer:"A"}]);
            setMode('READY');
        };

        const launch = () => {
            physics.current = { y: 250, v: 0, pipes: [], frames: 0, score: 0 };
            setScore(0);
            setBirdY(250);
            setPipes([]);
            setBotScore(0);
            setMode('PLAYING');
        };

        const handleConfirm = () => {
            if (selectedOption === currentCard.answer) {
                physics.current.score += 1;
                setScore(physics.current.score);
                onXPAction && onXPAction(2);
                setMode('PLAYING');
            } else {
                setMode('GAME_OVER');
            }
        };

        useEffect(() => {
            if (mode !== 'PLAYING') return;
            let req;
            const loop = () => {
                const p = physics.current;
                p.frames++;
                p.v += 0.6;
                p.y += p.v;

                if (p.frames % 150 === 0) {
                    p.pipes.push({ id: Date.now(), x: 500, h: Math.floor(Math.random() * 200) + 100, passed: false });
                }

                p.pipes.forEach(pipe => {
                    pipe.x -= 3;
                    // Question Trigger
                    if (!pipe.passed && pipe.x < 150 && pipe.x > 145) {
                        const card = cards[Math.floor(Math.random() * cards.length)];
                        if (card) {
                            setCurrentCard(card);
                            setMode('QUESTION');
                        }
                    }
                    // Collision
                    if (pipe.x < 90 && pipe.x > 10 && (p.y < pipe.h || p.y > pipe.h + 150)) {
                        setMode('GAME_OVER');
                    }
                });

                if (p.pipes.length > 0 && p.pipes[0].x < -60) p.pipes.shift();
                if (p.y > 470 || p.y < 0) setMode('GAME_OVER');

                setBirdY(p.y);
                setPipes([...p.pipes]);
                setVelocity(p.v);

                if (mode === 'PLAYING') req = requestAnimationFrame(loop);
            };
            loop();
            return () => cancelAnimationFrame(req);
        }, [mode, cards]);

        // Input
        useEffect(() => {
            const jump = (e) => { if(mode==='PLAYING' && (e.code==='Space'||e.type==='mousedown')) physics.current.v = -8; };
            window.addEventListener('keydown', jump); window.addEventListener('mousedown', jump);
            return () => { window.removeEventListener('keydown', jump); window.removeEventListener('mousedown', jump); };
        }, [mode]);

        return (
            <GlassCard className="p-0 flex flex-col items-center overflow-hidden w-full max-w-lg shadow-2xl relative min-h-[500px] border-4 border-slate-700 bg-slate-800">
                <div className="w-full h-[500px] relative overflow-hidden">
                     {/* Bird */}
                     <div style={{ top: birdY, left: 50, transform: `rotate(${velocity * 3}deg)` }} className="absolute w-8 h-8 z-20 bg-yellow-400 rounded-full border-2 border-white"></div>
                     {/* Pipes */}
                     {pipes.map(p => (
                         <React.Fragment key={p.id}>
                             <div style={{ left: p.x, height: p.h, width: 50 }} className="absolute top-0 bg-green-500 border-x-2 border-green-300 rounded-b-lg"></div>
                             <div style={{ left: p.x, top: p.h + 150, bottom: 0, width: 50 }} className="absolute bg-green-500 border-x-2 border-green-300 rounded-t-lg"></div>
                         </React.Fragment>
                     ))}
                     {/* Score */}
                     <div className="absolute top-4 left-4 z-30 text-5xl font-bold text-white drop-shadow-md">{score}</div>
                     <div className="absolute top-4 left-4 z-30 text-sm font-bold text-white mt-12">Global: 1240 | High: {highScore}</div>
                </div>

                {/* Overlays */}
                {mode === 'MENU' && (
                    <div className="absolute inset-0 bg-black/80 flex flex-col items-center justify-center p-8 z-40">
                        <Ghost className="w-16 h-16 text-green-400 mb-4" />
                        <h3 className="text-3xl font-bold text-white mb-6">Sky Hop</h3>
                        <input value={topic} onChange={e => setTopic(e.target.value)} placeholder="Enter Subject" className="w-full bg-slate-900 border border-white/10 rounded-xl px-4 py-3 text-white mb-4" />
                        <button onClick={start} disabled={!topic} className="w-full py-3 bg-green-600 text-white font-bold rounded-xl">Generate & Play</button>
                    </div>
                )}
                {mode === 'LOADING' && <div className="absolute inset-0 bg-black/80 flex items-center justify-center text-white"><Loader2 className="animate-spin mr-2"/> Generatin Cards...</div>}
                {mode === 'READY' && (
                    <div className="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-40">
                         <h3 className="text-white font-bold text-2xl mb-4">Ready?</h3>
                         <button onClick={launch} className="px-8 py-3 bg-cyan-500 text-white font-bold rounded-full">START</button>
                    </div>
                )}
                {(mode === 'QUESTION' || mode === 'CONFIRM') && currentCard && (
                    <div className="absolute inset-0 bg-black/90 flex items-center justify-center p-6 z-50">
                        <div className="w-full max-w-sm">
                            <h3 className="text-white font-bold mb-4 text-center">{currentCard.question}</h3>
                            {mode === 'QUESTION' ? (
                                <div className="space-y-2">
                                    {currentCard.options?.map(opt => (
                                        <button key={opt} onClick={() => { setSelectedOption(opt); setMode('CONFIRM'); }} className="w-full p-3 bg-slate-800 rounded-lg text-slate-200">{opt}</button>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center">
                                    <p className="text-slate-400 text-xs mb-2">Selected: {selectedOption}</p>
                                    <div className="flex gap-2">
                                        <button onClick={() => setMode('QUESTION')} className="flex-1 py-2 bg-slate-700 rounded-lg text-white">Back</button>
                                        <button onClick={handleConfirm} className="flex-1 py-2 bg-green-500 rounded-lg text-white">Confirm</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                )}
                {mode === 'GAME_OVER' && (
                    <div className="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-50">
                        <h3 className="text-3xl font-bold text-white mb-2">Crashed!</h3>
                        <p className="text-white mb-6">Score: {score}</p>
                        <button onClick={() => { launch(); }} className="px-6 py-2 bg-cyan-600 text-white rounded-xl mb-2">Retry Level</button>
                        <button onClick={() => setMode('MENU')} className="px-6 py-2 bg-slate-700 text-white rounded-xl">Menu</button>
                    </div>
                )}
            </GlassCard>
        );
      };

      // --- OTHER GAMES (Simulated) ---
      const SnakeGame = ({ onWin }) => <div className="text-center p-10 text-white">Snake Game Placeholder</div>;
      const PongGame = ({ onWin }) => <div className="text-center p-10 text-white">Pong Game Placeholder</div>;
      const MathSprint = ({ onWin }) => <div className="text-center p-10 text-white">Math Sprint Placeholder</div>;
      const MemoryMatch = ({ onWin }) => <div className="text-center p-10 text-white">Memory Match Placeholder</div>;
      const UniversalQuiz = ({ config }) => <div className="text-center p-10 text-white">Quiz: {config.name}</div>;

      // --- NOTES COMPONENT ---
      const Notes = ({ user, onXPAction }) => {
        const [notes, setNotes] = useState([]);
        const [newTitle, setNewTitle] = useState('');
        const [newContent, setNewContent] = useState('');
        
        const addNote = () => {
             const n = { id: Date.now(), title: newTitle, content: newContent, createdAt: new Date().toLocaleDateString() };
             setNotes([n, ...notes]);
             setNewTitle(''); setNewContent('');
             onXPAction(5);
        };

        return (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 h-full">
                <GlassCard className="col-span-1">
                    <h3 className="text-white font-bold mb-4">New Note</h3>
                    <input value={newTitle} onChange={e=>setNewTitle(e.target.value)} placeholder="Title" className="w-full bg-slate-900/50 border border-white/10 rounded-lg p-3 text-white mb-3" />
                    <textarea value={newContent} onChange={e=>setNewContent(e.target.value)} placeholder="Content" className="w-full h-32 bg-slate-900/50 border border-white/10 rounded-lg p-3 text-white mb-3" />
                    <button onClick={addNote} className="w-full py-2 bg-cyan-600 text-white rounded-lg font-bold">Save (+5 XP)</button>
                </GlassCard>
                <div className="col-span-2 space-y-4 overflow-y-auto">
                    {notes.map(n => (
                        <GlassCard key={n.id} className="cursor-pointer hover:bg-white/5">
                            <h4 className="text-white font-bold">{n.title}</h4>
                            <p className="text-slate-400 text-sm">{n.content}</p>
                        </GlassCard>
                    ))}
                    {notes.length === 0 && <div className="text-slate-500 text-center mt-10">No notes yet.</div>}
                </div>
            </div>
        );
      };

      // --- LAYOUT ---
      const Layout = ({ children, activeTab, setActiveTab, user }) => {
          const navItems = [
              { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
              { id: 'notes', label: 'Notes & Quiz', icon: BookOpen },
              { id: 'games', label: 'Arcade', icon: Gamepad2 },
              { id: 'pomodoro', label: 'Focus', icon: Timer },
              { id: 'chat', label: 'Chat', icon: MessageSquare },
          ];

          return (
              <div className="flex h-screen bg-[#020617] text-slate-100 font-sans overflow-hidden">
                  <aside className="w-64 bg-[#0F172A]/40 backdrop-blur-3xl border-r border-white/5 flex flex-col p-4">
                      <div className="flex items-center gap-3 px-4 py-4 mb-6">
                          <Hexagon className="w-8 h-8 text-cyan-500" />
                          <div><h1 className="font-bold text-white tracking-tight">GEAR HUB</h1><p className="text-[10px] text-cyan-400 font-bold uppercase">Student OS</p></div>
                      </div>
                      <nav className="space-y-1 flex-1">
                          {navItems.map(item => {
                              const IconC = item.icon;
                              return (
                                  <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all ${activeTab === item.id ? 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20' : 'text-slate-400 hover:text-white hover:bg-white/5'}`}>
                                      <IconC className="w-5 h-5" /> <span className="text-sm font-medium">{item.label}</span>
                                  </button>
                              );
                          })}
                      </nav>
                      <div className="mt-auto px-4 py-4 border-t border-white/5">
                          <div className="flex items-center gap-3">
                              <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500 to-blue-600 flex items-center justify-center text-xs font-bold text-white">{user.name.charAt(0)}</div>
                              <div className="text-xs"><div className="font-bold text-white">{user.name}</div><div className="text-slate-500">Lvl {user.level}</div></div>
                          </div>
                      </div>
                  </aside>
                  <main className="flex-1 overflow-y-auto relative p-8">
                      <div className="max-w-7xl mx-auto pb-20">{children}</div>
                  </main>
              </div>
          );
      };

      // --- APP ROOT ---
      const App = () => {
          const [activeTab, setActiveTab] = useState('dashboard');
          const [user, setUser] = useState({ name: 'Student', level: 1, xp: 0 });

          const handleXP = (amount) => {
              setUser(u => {
                  const newXp = u.xp + amount;
                  const newLevel = Math.floor(Math.sqrt(newXp / 100)) + 1;
                  return { ...u, xp: newXp, level: newLevel };
              });
          };

          return (
              <Layout activeTab={activeTab} setActiveTab={setActiveTab} user={user}>
                  {activeTab === 'dashboard' && (
                      <div className="space-y-6">
                          <h2 className="text-3xl font-bold text-white">Welcome back, {user.name}</h2>
                          <div className="grid grid-cols-3 gap-6">
                              <GlassCard><h3 className="text-slate-400 mb-1">Current Level</h3><div className="text-4xl font-bold text-white">{user.level}</div></GlassCard>
                              <GlassCard><h3 className="text-slate-400 mb-1">Total XP</h3><div className="text-4xl font-bold text-cyan-400">{user.xp}</div></GlassCard>
                              <GlassCard><h3 className="text-slate-400 mb-1">Assignments</h3><div className="text-4xl font-bold text-purple-400">3</div></GlassCard>
                          </div>
                      </div>
                  )}
                  {activeTab === 'games' && <Games user={user} onXPAction={handleXP} />}
                  {activeTab === 'notes' && <Notes user={user} onXPAction={handleXP} />}
                  {activeTab === 'pomodoro' && (
                      <div className="flex flex-col items-center justify-center h-[500px]">
                          <div className="text-6xl font-mono text-white mb-8">25:00</div>
                          <div className="flex gap-4">
                              <button className="px-8 py-3 bg-cyan-600 text-white rounded-full font-bold">Start Focus</button>
                              <button onClick={()=>setActiveTab('games')} className="px-8 py-3 bg-purple-600/20 text-purple-300 rounded-full font-bold border border-purple-500/50">Break Mode (Arcade)</button>
                          </div>
                      </div>
                  )}
                  {activeTab === 'chat' && <div className="text-center text-slate-500 mt-20">Chat Module Placeholder</div>}
              </Layout>
          );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>