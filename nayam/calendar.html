<!DOCTYPE html>
<div class="backbar" style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
  <button class="back" onclick="history.back()">‚Üê Back</button>
</div>
<html lang="en">
<head>
  <link rel="stylesheet" href="../ugly.css">
  <meta charset="UTF-8">
  <title>Calendar | GEAR HUB (HTML)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; font-family: Inter, system-ui, sans-serif; background:transparent; color:var(--text); }
    .app { display:flex; height:100vh; }
    .aside { width:280px; background:transparent; display:flex; flex-direction:column; }
    .main { flex:1; display:flex; flex-direction:column; }
    .header { height:80px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; border-bottom:1px solid var(--sep-weak); background:transparent; position:sticky; top:0; }
    .content { flex:1; overflow:auto; padding:24px; }
    .glass { background: var(--card-bg); border:1px solid var(--sep-weak); border-radius: 24px; padding: 24px; }
    .grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
    .day { border:1px solid var(--sep-weak); border-radius:12px; min-height:90px; padding:8px; }
    .small { font-size:12px; }
  .event { font-size:10px; background:var(--primary); color:#fff; border-radius:8px; padding:2px 6px; margin-top:4px; display:inline-block; }
  .btn { padding:8px 12px; border-radius:12px; border:0; background: linear-gradient(90deg,var(--primary),var(--sea-top)); color:#fff; cursor:pointer; }
  .input { width:100%; padding:10px; border-radius:12px; border:1px solid var(--sep-weak); background: var(--card-bg); color:var(--text); }
  </style>
</head>
<body>
  <div class="app">
    <aside class="aside">
  <div style="padding:24px; display:flex; align-items:center; gap:12px;">
  <div class="brand-mark">‚¨¢</div>
        <div><div style="font-weight:700">GEAR HUB</div></div>
      </div>
      <nav style="padding:12px; overflow:auto">
        <button class="btn" onclick="location.href='../nayam/dashboard.html'">üè† Dashboard</button>
        <button class="btn" onclick="location.href='calendar.html'">üìÖ Calendar</button>
      </nav>
      <div style="margin-top:auto;padding:16px"><button class="btn" onclick="logout()">Sign Out</button></div>
    </aside>

    <main class="main">
      <header class="header">
        <h2 id="monthTitle">Month Year</h2>
        <button class="btn" onclick="openAdd()">+ Add Event</button>
      </header>
      <div class="content">
        <div class="glass">
          <div class="grid" id="grid"></div>
        </div>
        <div class="glass" style="margin-top:16px">
          <h3>Upcoming Events</h3>
          <div id="upcoming"></div>
        </div>
      </div>
    </main>
  </div>

  <div id="modal" style="display:none; position:fixed; inset:0; background:var(--overlay-deep); align-items:center; justify-content:center;">
    <div class="glass" style="width:380px">
      <h3>Add Event</h3>
      <input id="eTitle" class="input" placeholder="Title">
      <input id="eDate" class="input" placeholder="Date (YYYY-MM-DD)">
      <input id="eStart" class="input" placeholder="Start Time (HH:MM)">
      <input id="eEnd" class="input" placeholder="End Time (HH:MM)">
      <input id="eLocation" class="input" placeholder="Location (optional)">
      <div style="text-align:right;margin-top:8px">
        <button class="btn" onclick="closeAdd()">Cancel</button>
        <button class="btn" onclick="saveEvent()">Save</button>
      </div>
    </div>
  </div>

  <script>
    const ACTIVE_SESSION_KEY='gearhub_active_session', STORAGE_KEY='gearhub_events_global';
    const user = JSON.parse(localStorage.getItem(ACTIVE_SESSION_KEY) || 'null'); if(!user) location.href='../arjun/login.html';
    function logout(){ localStorage.removeItem(ACTIVE_SESSION_KEY); location.href='../arjun/login.html'; }

    let events = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    const now = new Date(); const year=now.getFullYear(), month=now.getMonth();
    document.getElementById('monthTitle').textContent = now.toLocaleString('default',{ month:'long', year:'numeric' });

    renderGrid(); renderUpcoming();

    function renderGrid(){
      const firstDay = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month+1, 0).getDate();
      const grid = document.getElementById('grid'); grid.innerHTML='';
      const headers = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      headers.forEach(h=>{ const d=document.createElement('div'); d.className='small'; d.textContent=h; grid.appendChild(d); });
      for(let i=0;i<firstDay;i++){ const spacer=document.createElement('div'); grid.appendChild(spacer); }
      for(let d=1; d<=daysInMonth; d++){
        const cell = document.createElement('div'); cell.className='day';
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        cell.innerHTML = `<div class="small">${d}</div>`;
        events.filter(e=>e.date===dateStr).forEach(e=>{
          const ev=document.createElement('div'); ev.className='event'; ev.textContent=e.title; cell.appendChild(ev);
        });
        grid.appendChild(cell);
      }
    }

    function renderUpcoming(){
      const box = document.getElementById('upcoming'); box.innerHTML='';
      const upcoming = events.filter(e=> new Date(e.date)>=new Date()).sort((a,b)=> new Date(a.date)-new Date(b.date));
      if(upcoming.length===0){ box.innerHTML='<div class="small">No upcoming events.</div>'; return; }
      upcoming.forEach(e=>{
        const row=document.createElement('div'); row.style.margin='8px 0';
        row.innerHTML = `<div class="row"><div class="chip">${e.date}</div><div>${e.title}</div></div><div class="small">${e.startTime} - ${e.endTime} ${e.location?('| '+e.location):''}</div>`;
        box.appendChild(row);
      });
    }

    function openAdd(){ document.getElementById('modal').style.display='flex'; }
    function closeAdd(){ document.getElementById('modal').style.display='none'; }
    function saveEvent(){
      const title=eTitle.value.trim(), date=eDate.value.trim(), start=eStart.value.trim(), end=eEnd.value.trim(), loc=eLocation.value.trim();
      if(!title || !date || !start || !end) return alert('Fill all required fields.');
      const rec = { id:Date.now().toString(), title, date, startTime:start, endTime:end, type:'school', location:loc, description:'', createdBy:user.id };
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); all.push(rec); localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
      events.push(rec); renderGrid(); renderUpcoming(); closeAdd();
    }
  </script>
</body>
</html>