<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | GEAR HUB (HTML)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root { --bg:#020617; --panel:rgba(15,23,42,0.6); --text:#F8FAFC; }
    body { margin:0; font-family: Inter, system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .app { display:flex; height:100vh; }
    .aside { width:280px; background: rgba(15,23,42,0.4); backdrop-filter: blur(24px); border-right:1px solid rgba(255,255,255,0.06); display:flex; flex-direction:column; }
    .main { flex:1; display:flex; flex-direction:column; }
    .header { height:80px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; border-bottom:1px solid rgba(255,255,255,0.08); background: rgba(2,6,23,0.6); backdrop-filter: blur(16px); position:sticky; top:0; }
    .content { flex:1; overflow:auto; padding:24px; }
    .glass { background: var(--panel); backdrop-filter: blur(24px); border:1px solid rgba(255,255,255,0.08); border-radius: 24px; box-shadow: 0 10px 40px -10px rgba(6,182,212,0.25); padding: 24px; }
    .nav-btn { width:100%; display:flex; gap:12px; align-items:center; padding:12px 16px; color:#cbd5e1; border-radius:16px; border:1px solid transparent; cursor:pointer; }
    .nav-btn:hover { background: rgba(255,255,255,0.06); color:#e2e8f0; }
    .badge { font-size:10px; text-transform:uppercase; color:#22d3ee; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .col { flex:1; min-width:220px; }
    .input { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: rgba(2,6,23,0.6); color: #fff; }
    .btn { padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(6,182,212,0.2); color:#fff; cursor:pointer; }
    .btn-primary { background: linear-gradient(90deg,#06b6d4,#3b82f6); border: none; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); background: rgba(30,41,59,0.7); }
  </style>
</head>
<body>
  <div class="app">
    <aside class="aside">
      <div style="padding:24px; display:flex; align-items:center; gap:12px;">
        <div style="width:40px;height:40px;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 20px -10px rgba(6,182,212,0.4)">â¬¢</div>
        <div>
          <div style="font-weight:700">GEAR HUB</div>
          <div id="roleBadge" class="badge">Student Edition</div>
        </div>
      </div>
      <nav style="padding:12px; overflow:auto">
        <button class="nav-btn" onclick="location.href='dashboard.html'">ğŸ  Dashboard</button>
        <button class="nav-btn" onclick="location.href='notes.html'">ğŸ“’ Study & Notes</button>
        <button class="nav-btn" onclick="location.href='timetable.html'">ğŸ“† Timetable</button>
        <button class="nav-btn" onclick="location.href='imeet.html'">ğŸ¥ iMeet Live</button>
        <button class="nav-btn" onclick="location.href='pomodoro.html'">â±ï¸ Focus Timer</button>
        <button class="nav-btn" onclick="location.href='games.html'">ğŸ® Arcade Zone</button>
        <button class="nav-btn" onclick="location.href='chat.html'">ğŸ’¬ Collaboration</button>
        <button class="nav-btn" onclick="location.href='grades.html'">ğŸ“Š Performance</button>
        <button id="teacherNav" class="nav-btn" style="display:none" onclick="location.href='teacher-tools.html'">ğŸ‘©â€ğŸ« Teacher Tools</button>
        <button id="adminNav" class="nav-btn" style="display:none" onclick="location.href='admin.html'">ğŸ›¡ï¸ Admin Console</button>
      </nav>
      <div style="margin-top:auto;padding:16px">
        <button class="btn" onclick="logout()">Sign Out</button>
      </div>
    </aside>

    <main class="main">
      <header class="header">
        <div style="flex:1; max-width:600px;">
          <input id="search" class="input" placeholder="Search for notes, assignments, or people...">
        </div>
        <div class="row">
          <button class="btn" onclick="alert('Settings (HTML)')">âš™ï¸</button>
          <div class="pill" id="userCapsule">User</div>
        </div>
      </header>
      <div class="content">
        <div class="row" style="align-items:flex-end">
          <div style="flex:1">
            <h2 id="greeting" style="font-size:36px; margin:0 0 6px 0;">Good Day, User</h2>
            <div style="color:#94a3b8">Ready to achieve your goals today?</div>
          </div>
          <div class="pill" style="display:flex;align-items:center;gap:16px;padding:12px 20px;">
            <div id="levelBadge" style="width:60px;height:60px;border-radius:999px;background:linear-gradient(135deg,#facc15,#f97316);display:flex;align-items:center;justify-content:center;color:#111827;font-weight:800;font-size:24px;">1</div>
            <div>
              <div style="font-size:12px;color:#e2e8f0;font-weight:700;display:flex;justify-content:space-between;gap:10px">
                <span>Level Progress</span><span id="xpText" style="color:#22d3ee">0 XP</span>
              </div>
              <div style="width:200px;height:10px;border-radius:999px;background:#0f172a;border:1px solid rgba(255,255,255,0.08);overflow:hidden">
                <div id="xpBar" style="height:100%;width:0%;background:linear-gradient(90deg,#06b6d4,#3b82f6)"></div>
              </div>
            </div>
            <div style="border-left:1px solid rgba(255,255,255,0.12);padding-left:12px;display:flex;align-items:center;gap:6px;color:#fb923c">
              âš¡ <span id="streakText" style="font-weight:700">0</span> Day
            </div>
          </div>
        </div>

        <div class="row mt">
          <div class="glass col">
            <div>ğŸ•’ Study Hours</div>
            <div id="studyHours" style="font-size:28px;font-weight:800">0h</div>
          </div>
          <div class="glass col">
            <div>âœ… Notes Completed</div>
            <div id="completedTasks" style="font-size:28px;font-weight:800">0</div>
          </div>
          <div class="glass col">
            <div>ğŸ“š Study Notes</div>
            <div id="notesCount" style="font-size:28px;font-weight:800">0</div>
          </div>
          <div class="glass col">
            <div>ğŸ¯ Active Tasks</div>
            <div id="pendingTasks" style="font-size:28px;font-weight:800">0</div>
          </div>
        </div>

        <div class="row mt">
          <div class="glass" style="flex:2">
            <div class="row" style="justify-content:space-between">
              <div class="row" style="align-items:center"><span>ğŸ§ </span><strong>Quick Scratchpad</strong></div>
              <div class="row"><span id="saveStatus" style="display:none;color:#86efac;font-size:12px;font-weight:700">Saved!</span><button class="btn" onclick="saveScratch()">Save Note</button></div>
            </div>
            <input id="scratchTitle" class="input mt" placeholder="Note Title...">
            <textarea id="scratchContent" class="input mt" style="height:120px" placeholder="Write your thoughts here..."></textarea>
            <div class="mt"><button class="btn" onclick="newScratch()">+ New Entry</button></div>
            <div id="scratchList" class="mt"></div>
          </div>

          <div class="glass" style="flex:1">
            <strong>Quick Actions</strong>
            <div class="mt"><button class="btn btn-primary" onclick="location.href='notes.html'">Create New Note (+20 XP)</button></div>
          </div>
        </div>

        <div class="mt">
          <h3>ğŸ“ˆ Recent Activity</h3>
          <div id="activityFeed" class="mt"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const ACTIVE_SESSION_KEY = 'gearhub_active_session';
    const user = JSON.parse(localStorage.getItem(ACTIVE_SESSION_KEY) || 'null');
    if (!user) location.href='login.html';

    document.getElementById('roleBadge').textContent = `${user.role || 'Student'} Edition`;
    document.getElementById('userCapsule').textContent = `${user.name} | Lvl ${user.level}`;
    document.getElementById('greeting').textContent = `Good ${new Date().getHours()<12?'Morning':'Evening'}, ${user.name.split(' ')[0]}`;
    document.getElementById('levelBadge').textContent = user.level || 1;
    document.getElementById('xpText').textContent = `${user.xp || 0} XP`;
    document.getElementById('streakText').textContent = user.streak || 0;
    const levelProgress = ((user.xp || 0) % 100) / 100 * 100;
    document.getElementById('xpBar').style.width = `${levelProgress}%`;

    // Role-based nav
    if (user.role === 'TEACHER') document.getElementById('teacherNav').style.display='block';
    if (user.role === 'ADMIN') document.getElementById('adminNav').style.display='block';

    function logout(){ localStorage.removeItem(ACTIVE_SESSION_KEY); location.href='login.html'; }

    const SCRATCHPAD_KEY = `gearhub_scratchpad_${user.id}`;
    let scratchpad = JSON.parse(localStorage.getItem(SCRATCHPAD_KEY) || '[]');
    let currentNote = scratchpad.find(n => !n.completed) || { id: Date.now().toString(), title:'', content:'', completed:false, updatedAt:new Date().toISOString() };
    document.getElementById('scratchTitle').value = currentNote.title || '';
    document.getElementById('scratchContent').value = currentNote.content || '';

    document.getElementById('scratchTitle').addEventListener('input', e => currentNote.title = e.target.value);
    document.getElementById('scratchContent').addEventListener('input', e => currentNote.content = e.target.value);

    function renderScratch() {
      const list = document.getElementById('scratchList');
      if (scratchpad.length === 0) { list.innerHTML = '<div style="color:#94a3b8;font-size:12px">No notes found.</div>'; return; }
      list.innerHTML = scratchpad.map(n => `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid rgba(255,255,255,0.08)">
          <div style="cursor:pointer" onclick="loadScratch('${n.id}')">${n.title || '(Untitled)'}</div>
          <div class="row">
            ${!n.completed?`<button class="btn" onclick="completeScratch('${n.id}')">âœ”ï¸</button>`:''}
            <button class="btn" onclick="deleteScratch('${n.id}')">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('');
    }
    renderScratch();

    function newScratch(){
      currentNote = { id: Date.now().toString(), title:'', content:'', completed:false, updatedAt:new Date().toISOString() };
      document.getElementById('scratchTitle').value = '';
      document.getElementById('scratchContent').value = '';
    }
    function loadScratch(id){
      const n = scratchpad.find(s=>s.id===id); if(!n) return;
      currentNote = n;
      document.getElementById('scratchTitle').value = n.title || '';
      document.getElementById('scratchContent').value = n.content || '';
    }
    function saveScratch(){
      if (!currentNote.title.trim()) { alert('Please enter a title'); return; }
      const idx = scratchpad.findIndex(s=>s.id===currentNote.id);
      currentNote.updatedAt = new Date().toISOString();
      if (idx>=0) scratchpad[idx] = currentNote; else scratchpad = [currentNote, ...scratchpad];
      localStorage.setItem(SCRATCHPAD_KEY, JSON.stringify(scratchpad));
      const ss = document.getElementById('saveStatus'); ss.style.display='inline';
      setTimeout(()=>ss.style.display='none',1200);
      renderScratch();
      addXP(2);
    }
    function completeScratch(id){
      scratchpad = scratchpad.map(s=>s.id===id?{...s, completed:true}:s);
      localStorage.setItem(SCRATCHPAD_KEY, JSON.stringify(scratchpad));
      if (currentNote.id===id) newScratch();
      renderScratch();
    }
    function deleteScratch(id){
      scratchpad = scratchpad.filter(s=>s.id!==id);
      localStorage.setItem(SCRATCHPAD_KEY, JSON.stringify(scratchpad));
      if (currentNote.id===id) newScratch();
      renderScratch();
    }

    // Stats & activity
    const NOTES_KEY = 'gearhub_all_notes';
    const notes = JSON.parse(localStorage.getItem(NOTES_KEY) || '[]').filter(n => n.authorId === user.id);
    const TIMETABLE_KEY = `gearhub_timetable_${user.id}`;
    const timetable = JSON.parse(localStorage.getItem(TIMETABLE_KEY) || '[]');

    document.getElementById('notesCount').textContent = notes.length;
    document.getElementById('completedTasks').textContent = scratchpad.filter(n=>n.completed).length;
    document.getElementById('pendingTasks').textContent = scratchpad.filter(n=>!n.completed).length;
    document.getElementById('studyHours').textContent = Math.floor(notes.length*1.5 + timetable.length*0.8)+'h';

    const feed = document.getElementById('activityFeed');
    const activities = notes.slice(0,3).map(n => ({title:`Created note: ${n.title}`, time:'Recently'}));
    feed.innerHTML = activities.length ? activities.map(a=>`
      <div class="glass" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div class="row">
          <div style="width:40px;height:40px;border-radius:12px;background:rgba(59,130,246,0.2);display:flex;align-items:center;justify-content:center">ğŸ“š</div>
          <div><strong>${a.title}</strong><div style="font-size:12px;color:#94a3b8">${a.time}</div></div>
        </div>
        <div class="pill" style="color:#86efac;border-color:rgba(34,197,94,0.3)">+10 XP</div>
      </div>
    `).join('') : '<div style="color:#94a3b8">No recent activity</div>';

    function addXP(amount){
      const newXP = (user.xp||0) + amount;
      const newLevel = Math.floor(Math.sqrt(newXP/100)) + 1;
      user.xp = newXP; user.level = newLevel;
      localStorage.setItem(ACTIVE_SESSION_KEY, JSON.stringify(user));
      document.getElementById('xpText').textContent = `${newXP} XP`;
      document.getElementById('levelBadge').textContent = newLevel;
      document.getElementById('xpBar').style.width = `${((newXP%100)/100)*100}%`;
    }
  </script>
</body>
</html>