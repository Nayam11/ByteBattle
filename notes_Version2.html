<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notes | GEAR HUB (HTML)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root { --bg:#020617; --panel:rgba(15,23,42,0.6); --text:#F8FAFC; }
    body { margin:0; font-family: Inter, system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .app { display:flex; height:100vh; }
    .aside { width:280px; background: rgba(15,23,42,0.4); backdrop-filter: blur(24px); border-right:1px solid rgba(255,255,255,0.06); display:flex; flex-direction:column; }
    .main { flex:1; display:flex; flex-direction:column; }
    .header { height:80px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; border-bottom:1px solid rgba(255,255,255,0.08); background: rgba(2,6,23,0.6); backdrop-filter: blur(16px); position:sticky; top:0; }
    .content { flex:1; overflow:auto; padding:24px; }
    .glass { background: var(--panel); backdrop-filter: blur(24px); border:1px solid rgba(255,255,255,0.08); border-radius: 24px; box-shadow: 0 10px 40px -10px rgba(6,182,212,0.25); padding: 24px; }
    .nav-btn { width:100%; display:flex; gap:12px; align-items:center; padding:12px 16px; color:#cbd5e1; border-radius:16px; border:1px solid transparent; cursor:pointer; }
    .nav-btn:hover { background: rgba(255,255,255,0.06); color:#e2e8f0; }
    .row { display:flex; gap:16px; }
    .col { flex:1; }
    .input { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: rgba(2,6,23,0.6); color: #fff; }
    .btn { padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(6,182,212,0.2); color:#fff; cursor:pointer; }
    .btn-primary { background: linear-gradient(90deg,#06b6d4,#3b82f6); border: none; }
    .badge { font-size:10px; text-transform:uppercase; color:#22d3ee; }
    .list-item { padding:12px; border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:8px; background: rgba(255,255,255,0.06); cursor:pointer; }
    .small { font-size:12px; color:#94a3b8; }
    .chip { font-size:10px; padding:2px 6px; border-radius:10px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); }
    .quiz-opt { text-align:left; width:100%; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(2,6,23,0.6); color:#fff; cursor:pointer; margin:6px 0; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="aside">
      <div style="padding:24px; display:flex; align-items:center; gap:12px;">
        <div style="width:40px;height:40px;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 20px -10px rgba(6,182,212,0.4)">‚¨¢</div>
        <div>
          <div style="font-weight:700">GEAR HUB</div>
          <div id="roleBadge" class="badge">Student Edition</div>
        </div>
      </div>
      <nav style="padding:12px; overflow:auto">
        <button class="nav-btn" onclick="location.href='dashboard.html'">üè† Dashboard</button>
        <button class="nav-btn" onclick="location.href='notes.html'">üìí Study & Notes</button>
        <button class="nav-btn" onclick="location.href='timetable.html'">üìÜ Timetable</button>
        <button class="nav-btn" onclick="location.href='imeet.html'">üé• iMeet Live</button>
        <button class="nav-btn" onclick="location.href='pomodoro.html'">‚è±Ô∏è Focus Timer</button>
        <button class="nav-btn" onclick="location.href='games.html'">üéÆ Arcade Zone</button>
        <button class="nav-btn" onclick="location.href='chat.html'">üí¨ Collaboration</button>
        <button class="nav-btn" onclick="location.href='grades.html'">üìä Performance</button>
      </nav>
      <div style="margin-top:auto;padding:16px">
        <button class="btn" onclick="logout()">Sign Out</button>
      </div>
    </aside>

    <main class="main">
      <header class="header">
        <div style="flex:1; max-width:600px;">
          <input id="search" class="input" placeholder="Search notes...">
        </div>
        <div class="row">
          <button class="btn" onclick="alert('Settings (HTML)')">‚öôÔ∏è</button>
          <div class="chip" id="userCapsule">User</div>
        </div>
      </header>

      <div class="content">
        <div class="row">
          <!-- Create Note -->
          <div class="glass col">
            <h3>New Note</h3>
            <input id="newTitle" class="input" placeholder="Title">
            <input id="newSubject" class="input" placeholder="Subject (e.g., Biology)">
            <textarea id="newContent" class="input" style="height:120px" placeholder="Paste your content here..."></textarea>
            <div class="row">
              <label><input id="isPublic" type="checkbox"> <span class="small">Publish to Students (Teacher only)</span></label>
            </div>
            <button class="btn btn-primary" onclick="createNote()">Create Note (+20 XP)</button>
          </div>

          <!-- Notes List -->
          <div class="col">
            <div id="notesList"></div>
          </div>
        </div>

        <!-- Detail/AI -->
        <div class="glass mt">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div>
              <h2 id="detailTitle">Select a note</h2>
              <div class="row"><span id="detailSubject" class="chip">Subject</span><span id="detailPublic" class="chip" style="display:none">Public Resource</span></div>
            </div>
            <div class="row">
              <button class="btn" onclick="summarizeSelected()">‚ú® AI Summary</button>
              <button class="btn btn-primary" onclick="generateQuiz()">ü§ñ Generate Quiz</button>
            </div>
          </div>
          <div id="detailContent" class="mt small">Select a note to start studying</div>

          <div id="summaryBox" class="glass mt" style="display:none">
            <strong>Quick Summary</strong>
            <div id="summaryText" class="mt small"></div>
          </div>

          <div id="quizBox" class="glass mt" style="display:none">
            <div class="row" style="justify-content:space-between;align-items:center">
              <h3>Knowledge Check</h3>
              <div id="streakChip" class="chip" style="display:none">STREAK: 0</div>
            </div>
            <div id="quizArea" class="mt"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const ACTIVE_SESSION_KEY = 'gearhub_active_session';
    const user = JSON.parse(localStorage.getItem(ACTIVE_SESSION_KEY) || 'null');
    if (!user) location.href='login.html';

    document.getElementById('roleBadge').textContent = `${user.role || 'Student'} Edition`;
    document.getElementById('userCapsule').textContent = `${user.name} | Lvl ${user.level}`;
    document.getElementById('isPublic').disabled = user.role !== 'TEACHER';

    const STORAGE_KEY = 'gearhub_all_notes';
    let notes = [];
    let selected = null;
    let quizStreak = 0;

    function logout(){ localStorage.removeItem(ACTIVE_SESSION_KEY); location.href='login.html'; }

    function loadNotes(){
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      if (user.role === 'ADMIN') notes = all;
      else notes = all.filter(n => n.authorId === user.id || n.isPublic);
      renderList();
    }
    loadNotes();

    function renderList(){
      const list = document.getElementById('notesList');
      if (notes.length === 0) { list.innerHTML = '<div class="small">No notes.</div>'; return; }
      list.innerHTML = notes.map(n => `
        <div class="list-item" onclick="selectNote('${n.id}')">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>${n.title}</strong>
            ${n.authorId===user.id?`<button class="btn" onclick="event.stopPropagation();deleteNote('${n.id}')">üóëÔ∏è</button>`:''}
          </div>
          <div class="row small" style="justify-content:space-between;margin-top:6px">
            <span class="chip">${n.subject}</span>
            <span>${n.isPublic?'üåç':''} ${n.authorId!==user.id?'üîí':''} ${n.createdAt}</span>
          </div>
        </div>
      `).join('');
    }

    function createNote(){
      const title = document.getElementById('newTitle').value.trim();
      const subject = document.getElementById('newSubject').value.trim() || 'General';
      const content = document.getElementById('newContent').value.trim();
      const pub = document.getElementById('isPublic').checked && user.role === 'TEACHER';
      if (!title || !content) return alert('Title and content required.');

      const note = { id: Date.now().toString(), title, content, subject, tags:[], createdAt: new Date().toISOString().split('T')[0], authorId: user.id, isPublic: pub };
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      all.push(note);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
      document.getElementById('newTitle').value=''; document.getElementById('newSubject').value=''; document.getElementById('newContent').value='';
      addXP(20);
      loadNotes();
    }

    function deleteNote(id){
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]').filter(n=>n.id!==id);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
      if (selected?.id===id) { selected=null; clearDetail(); }
      loadNotes();
    }

    function selectNote(id){
      selected = notes.find(n=>n.id===id);
      document.getElementById('detailTitle').textContent = selected.title;
      document.getElementById('detailSubject').textContent = selected.subject;
      document.getElementById('detailPublic').style.display = selected.isPublic ? 'inline-block':'none';
      document.getElementById('detailContent').textContent = selected.content;
      // Hide AI areas
      document.getElementById('summaryBox').style.display='none';
      document.getElementById('quizBox').style.display='none';
      quizStreak = 0; document.getElementById('streakChip').style.display='none';
    }

    function clearDetail(){
      document.getElementById('detailTitle').textContent = 'Select a note';
      document.getElementById('detailSubject').textContent = 'Subject';
      document.getElementById('detailPublic').style.display = 'none';
      document.getElementById('detailContent').textContent = 'Select a note to start studying';
      document.getElementById('summaryBox').style.display='none';
      document.getElementById('quizBox').style.display='none';
    }

    function summarizeSelected(){
      if (!selected) return;
      const text = selected.content.split('\n').filter(l=>l.trim()).slice(0,6).map(l=>'‚Ä¢ '+l.substring(0,120)).join('\n');
      selected.summary = text;
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]').map(n=>n.id===selected.id?selected:n);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
      document.getElementById('summaryText').textContent = text;
      document.getElementById('summaryBox').style.display='block';
      addXP(5);
    }

    function generateQuiz(){
      if (!selected) return;
      quizStreak = 0; document.getElementById('streakChip').style.display='none';
      const questions = [
        { question:'What is the main idea?', options:['A','B','C','D'], correctAnswer:'A' },
        { question:'Which is true?', options:['True','False','Depends','Unknown'], correctAnswer:'True' },
        { question:'Apply concept?', options:['X','Y','Z','W'], correctAnswer:'Y' }
      ];
      const area = document.getElementById('quizArea');
      area.innerHTML = questions.map((q,i)=>`
        <div class="mt">
          <div><strong>${i+1}. ${q.question}</strong></div>
          ${q.options.map(opt=>`<button class="quiz-opt" onclick="answerQuiz('${opt}','${q.correctAnswer}')">${opt}</button>`).join('')}
        </div>
      `).join('');
      document.getElementById('quizBox').style.display='block';
    }

    function answerQuiz(sel, correct){
      if (sel === correct) {
        quizStreak += 1;
        document.getElementById('streakChip').style.display='inline-block';
        document.getElementById('streakChip').textContent = `STREAK: ${quizStreak}`;
        let bonus = (quizStreak % 3 === 0) ? 5 : 0;
        addXP(2 + bonus);
        alert('Correct!');
      } else {
        quizStreak = 0;
        document.getElementById('streakChip').style.display='none';
        alert('Incorrect!');
      }
    }

    function addXP(amount){
      const newXP = (user.xp||0) + amount;
      const newLevel = Math.floor(Math.sqrt(newXP/100)) + 1;
      user.xp = newXP; user.level = newLevel;
      localStorage.setItem(ACTIVE_SESSION_KEY, JSON.stringify(user));
      document.getElementById('userCapsule').textContent = `${user.name} | Lvl ${user.level}`;
    }
  </script>
</body>
</html>