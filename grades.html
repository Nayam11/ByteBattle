<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="ugly.css">
  <meta charset="UTF-8">
  <title>Grades | GEAR HUB (HTML)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root { --bg:#020617; --panel:rgba(15,23,42,0.6); --text:#F8FAFC; }
    body { margin:0; font-family: Inter, system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .app { display:flex; height:100vh; }
    .aside { width:280px; background: rgba(15,23,42,0.4); backdrop-filter: blur(24px); border-right:1px solid rgba(255,255,255,0.06); display:flex; flex-direction:column; }
    .main { flex:1; display:flex; flex-direction:column; }
    .header { height:80px; display:flex; align-items:center; justify-content:space-between; padding:0 24px; border-bottom:1px solid rgba(255,255,255,0.08); background: rgba(2,6,23,0.6); backdrop-filter: blur(16px); position:sticky; top:0; }
    .content { flex:1; overflow:auto; padding:24px; }
    .glass { background: var(--panel); backdrop-filter: blur(24px); border:1px solid rgba(255,255,255,0.08); border-radius: 24px; box-shadow: 0 10px 40px -10px rgba(6,182,212,0.25); padding: 24px; }
    .row { display:flex; gap:16px; }
    .col { flex:1; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { border-bottom:1px solid rgba(255,255,255,0.08); padding:10px; text-align:left; }
    .input { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: rgba(2,6,23,0.6); color: #fff; }
    .btn { padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background: rgba(6,182,212,0.2); color:#fff; cursor:pointer; }
    canvas { background: rgba(255,255,255,0.06); border-radius: 12px; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="aside">
      <div style="padding:24px; display:flex; align-items:center; gap:12px;">
        <div style="width:40px;height:40px;background:linear-gradient(135deg,#06b6d4,#3b82f6);border-radius:12px;display:flex;align-items:center;justify-content:center;">‚¨¢</div>
        <div><div style="font-weight:700">GEAR HUB</div></div>
      </div>
      <nav style="padding:12px; overflow:auto">
        <button class="btn" onclick="location.href='dashboard.html'">üè† Dashboard</button>
        <button class="btn" onclick="location.href='notes.html'">üìí Notes</button>
        <button class="btn" onclick="location.href='grades.html'">üìä Grades</button>
      </nav>
      <div style="margin-top:auto;padding:16px"><button class="btn" onclick="logout()">Sign Out</button></div>
    </aside>

    <main class="main">
      <header class="header"><h2 id="title">My Performance</h2><button id="addBtn" class="btn" style="display:none" onclick="openAdd()">+ Add Grade</button></header>
      <div class="content">
        <div class="row">
          <div class="glass col">
            <h3>Score Distribution</h3>
            <canvas id="chart" width="600" height="300"></canvas>
          </div>
          <div class="glass col">
            <h3>Records</h3>
            <table class="table" id="table">
              <thead><tr><th>Subject</th><th>Assessment</th><th>Score</th><th>Grade</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add Grade Modal -->
  <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center;">
    <div class="glass" style="width:360px;">
      <h3>Add Grade</h3>
      <input id="gSubject" class="input" placeholder="Subject">
      <input id="gTest" class="input" placeholder="Assessment">
      <input id="gScore" class="input" placeholder="Score (e.g., 85)">
      <input id="gTotal" class="input" placeholder="Total (e.g., 100)">
      <input id="gGrade" class="input" placeholder="Grade (e.g., A)">
      <div class="row" style="justify-content:flex-end">
        <button class="btn" onclick="closeAdd()">Cancel</button>
        <button class="btn" onclick="addGrade()">Save</button>
      </div>
    </div>
  </div>

  <script>
    const ACTIVE_SESSION_KEY='gearhub_active_session', STORAGE_KEY='gearhub_grades_global';
    const user = JSON.parse(localStorage.getItem(ACTIVE_SESSION_KEY) || 'null');
    if(!user) location.href='login.html';
    function logout(){ localStorage.removeItem(ACTIVE_SESSION_KEY); location.href='login.html'; }

    const title = document.getElementById('title'), addBtn = document.getElementById('addBtn');
    let grades = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    if(user.role==='TEACHER' || user.role==='ADMIN'){ title.textContent='Gradebook'; addBtn.style.display='inline-block'; }
    else { grades = grades.filter(g=>g.studentId===user.id); }

    renderTable(); renderChart();

    function renderTable(){
      const tbody = document.querySelector('#table tbody'); tbody.innerHTML='';
      if(grades.length===0){ tbody.innerHTML = `<tr><td colspan="4" style="color:#94a3b8">No grades recorded.</td></tr>`; return; }
      grades.forEach(g=>{
        const pct = Math.round((g.score/g.total)*100)+'%';
        tbody.innerHTML += `<tr><td><strong>${g.subject}</strong></td><td>${g.testName}</td><td>${g.score}/${g.total} (${pct})</td><td><strong style="color:#22d3ee">${g.grade||''}</strong></td></tr>`;
      });
    }

    function renderChart(){
      const data = grades.map(g=>({ subject:g.subject, score:g.score }));
      const cvs = document.getElementById('chart'), ctx=cvs.getContext('2d');
      ctx.clearRect(0,0,cvs.width,cvs.height);
      const max = Math.max(100, ...data.map(d=>d.score));
      const barW = Math.max(20, Math.floor(cvs.width / (data.length*2 || 1)));
      data.forEach((d,i)=>{
        const x = 40 + i*(barW*2);
        const h = Math.floor((d.score/max)*(cvs.height-40));
        ctx.fillStyle = '#06b6d4'; ctx.fillRect(x, cvs.height-20-h, barW, h);
        ctx.fillStyle='#94a3b8'; ctx.fillText(d.subject, x, cvs.height-6);
      });
    }

    function openAdd(){ document.getElementById('modal').style.display='flex'; }
    function closeAdd(){ document.getElementById('modal').style.display='none'; }
    function addGrade(){
      const subject = gSubject.value.trim(), testName=gTest.value.trim();
      const score = parseInt(gScore.value||'0'), total=parseInt(gTotal.value||'100'); const grade=gGrade.value.trim();
      if(!subject || !testName) return alert('Fill all fields.');
      const rec = { id: Date.now().toString(), studentId:user.id, studentName:user.name, subject, score, total, testName, grade };
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); all.push(rec); localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
      grades.push(rec); renderTable(); renderChart(); closeAdd();
    }
  </script>
</body>
</html>
